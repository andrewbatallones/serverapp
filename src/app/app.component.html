<div class="container py-4">
  <nav class="navbar navbar-dark" style="background-color: #0277bd;">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">Manage Servers</span>

      <div class="d-flex">
        <select (input)="filterServers($event)"
        name="status" class="btn btn-info me-2">
          <option value="ALL" selected>ALL</option>
          <option value="SERVER_UP">SERVER UP</option>
          <option value="SERVER_DOWN">SERVER DOWN</option>
        </select>
        <button type="button" class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#new-server-form">New Server</button>
        <button type="button" class="btn btn-primary me-4">Print Report</button>
      </div>
    </div>
  </nav>

  <ng-container *ngIf="(appState$ | async) as appState" [ngSwitch]="appState.dataState">
    <ng-container *ngSwitchCase="DataState.LOADING_STATE">
      <div class="col-md-12 single-note-item text-center">
        <div class="spinner-border text-info"></div>
      </div>
    </ng-container>

    <ng-container *ngSwitchCase="DataState.LOADED_STATE">
      <div>
        <table class="table" id="servers">
          <thead>
            <tr>
              <th scope="col">Image</th>
              <th scope="col">IP Address</th>
              <th scope="col">Name</th>
              <th scope="col">Memory</th>
              <th scope="col">Type</th>
              <th scope="col">Status</th>
              <th scope="col">Ping</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
      
          <tbody *ngFor="let server of appState.appData.data.servers">
            <tr>
              <td scope="row"><img [src]="server.imageUrl" [alt]="server.name" width="40" height="40"></td>
              <td>{{ server.ipAddress }}</td>
              <td>{{ server.name }}</td>
              <td>{{ server.memory }}</td>
              <td>{{ server.type }}</td>
              <td>
                <span class="badge"
                [ngClass]="[server.status == Status.SERVER_UP ? ' bg-success' : 'bg-danger']">
                  {{ server.status.replace('_', ' ') }}
                </span>
              </td>
              <td>
                <a (click)="pingServer(server.ipAddress)" style="cursor: pointer;">
                  <i *ngIf="(filterStatus$ | async) === '' || (filterStatus$ | async) !== server.ipAddress"
                  class="bi bi-router-fill"></i>
                  <div *ngIf="(filterStatus$ | async) === server.ipAddress"
                  class="spinner-grow text-info" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </a>
              </td>
              <td><i class="bi bi-trash-fill"></i></td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>

    <ng-container *ngSwitchCase="DataState.ERROR_STATE">
      <div class="alert-danger">{{ appState.error }}</div>
    </ng-container>
  </ng-container>

  <div class="modal fade" id="new-server-form" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="new-server-form-label">New Server</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="new-server" class="form-label">IP</label>
            <input type="text" class="form-control" id="new-server-ip">
          </div>
          <div class="mb-3">
            <label for="new-server" class="form-label">Name</label>
            <input type="text" class="form-control" id="new-server-name">
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="new-server" class="form-label">Memory</label>
              <input type="text" class="form-control" id="new-server-memory">
            </div>
            <div class="col">
              <label for="new-server" class="form-label">Type</label>
              <input type="text" class="form-control" id="new-server-type">
            </div>
          </div>
          <div class="mb-3">
            <label for="new-server" class="form-label">Status</label>
            <select class="form-select" name="server-status" id="new-server-status">
              <option value="1" selected>SERVER UP</option>
              <option value="2">SERVER TWO</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-success">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>